var jQueryCgmp=jQuery.noConflict();
(function(a){"undefined"!=typeof CGMPGlobal&&!CGMPGlobal.maps instanceof Array&&(CGMPGlobal.maps=[]);var c=function(){var a={};return{initMap:function(b,g,c,l){a=b;"ROADMAP"==l?l=google.maps.MapTypeId.ROADMAP:"SATELLITE"==l?l=google.maps.MapTypeId.SATELLITE:"HYBRID"==l?l=google.maps.MapTypeId.HYBRID:"TERRAIN"==l&&(l=google.maps.MapTypeId.TERRAIN);a.setOptions({zoom:c,mapTypeId:l,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}})},mapControl:function(b,C){switch(C){case c.ControlType.SCROLLWHEEL:a.setOptions({scrollwheel:"false"==
b?!1:!0});break;case c.ControlType.MAPTYPE:a.setOptions({mapTypeControl:"false"==b?!1:!0});break;case c.ControlType.PAN:a.setOptions({panControl:"false"==b?!1:!0});break;case c.ControlType.ZOOM:a.setOptions({zoomControl:"false"==b?!1:!0});break;case c.ControlType.SCALE:a.setOptions({scaleControl:"false"==b?!1:!0});break;case c.ControlType.STREETVIEW:a.setOptions({streetViewControl:"false"==b?!1:!0});break;default:g.warn("Unknown map control type: "+C)}},ControlType:{PAN:0,ZOOM:1,SCALE:2,STREETVIEW:3,
MAPTYPE:4,SCROLLWHEEL:5}}}(),o=function(){var a={};return{init:function(b){a=b},buildKmlLayer:function(b){if(0>b.toLowerCase().indexOf("http"))return g.error("KML URL must start with HTTP(S). Aborting.."),!1;var c=new google.maps.KmlLayer(b);google.maps.event.addListener(c,"status_changed",function(){var a=c.getStatus();if(a!=google.maps.KmlLayerStatus.OK){var b="";switch(a){case google.maps.KmlLayerStatus.DOCUMENT_NOT_FOUND:b=CGMPGlobal.errors.kmlNotFound;break;case google.maps.KmlLayerStatus.DOCUMENT_TOO_LARGE:b=
CGMPGlobal.errors.kmlTooLarge;break;case google.maps.KmlLayerStatus.FETCH_ERROR:b=CGMPGlobal.errors.kmlFetchError;break;case google.maps.KmlLayerStatus.INVALID_DOCUMENT:b=CGMPGlobal.errors.kmlDocInvalid;break;case google.maps.KmlLayerStatus.INVALID_REQUEST:b=CGMPGlobal.errors.kmlRequestInvalid;break;case google.maps.KmlLayerStatus.LIMITS_EXCEEDED:b=CGMPGlobal.errors.kmlLimits;break;case google.maps.KmlLayerStatus.TIMED_OUT:b=CGMPGlobal.errors.kmlTimedOut;break;case google.maps.KmlLayerStatus.UNKNOWN:b=
CGMPGlobal.errors.kmlUnknown}if(""!=b){var h=CGMPGlobal.errors.kml.replace("[MSG]",b),h=h.replace("[STATUS]",a);alert(h);g.error("Google returned KML error: "+b+" ("+a+")");g.error("KML file: "+c.getUrl())}}});c.setMap(a)},buildTrafficLayer:function(){(new google.maps.TrafficLayer).setMap(a)},buildBikeLayer:function(){(new google.maps.BicyclingLayer).setMap(a)},buildPanoramioLayer:function(b){if("undefined"==typeof google.maps.panoramio||!google.maps.panoramio||null==google.maps.panoramio)return g.error("We cannot access Panoramio library. Aborting.."),
!1;var c=new google.maps.panoramio.PanoramioLayer;c?(null!=b&&""!=b&&c.setUserId(b),c.setMap(a)):g.error("Could not instantiate Panoramio object. Aborting..")}}}(),I=function(){function c(){null!=s?i.setCenter()!=s.getCenter()&&(g.info("Panning map back to its original bounds center: "+s.getCenter()+" and updated zoom: "+p),i.setCenter(s.getCenter()),i.setZoom(p)):null!=x&&(g.info("Panning map back to its original center: "+x+" and updated zoom: "+p),i.setCenter(x),i.setZoom(p))}function b(e){a(e+
" input#a_address").val("");a(e+" input#b_address").val("");a(e+" input#a_address").removeClass("d_error");a(e+" input#b_address").removeClass("d_error")}function C(e,k){var d=R(e.content,k),f="div#direction-controls-placeholder-"+n,c=a("div#rendered-directions-placeholder-"+n);google.maps.event.addListener(e,"click",function(){b(f);a(f).fadeOut();t.setMap(null);c.html("");c.hide();a(f+" button#print_sub").hide();q.setContent(d.bubbleContent);q.setOptions({disableAutoPan:"true"==J?!1:!0});q.open(i,
this)});l(e,d,f);o(e,d,f,c)}function o(e,k,d,f){var g="div#bubble-"+k.bubbleHolderId,D=e.content,D=D.replace("Lat/Long: ","");a(g+" a.dirToHereTrigger").live("click",function(){this.id=="toHere-"+k.bubbleHolderId&&(a(d).fadeIn(),a(d+" input#a_address").val(""),a(d+" input#b_address").val(D),a(d+" input#radio_miles").attr("checked","checked"))});a(g+" a.dirFromHereTrigger").live("click",function(){this.id=="fromHere-"+k.bubbleHolderId&&(a(d).fadeIn(),a(d+" input#a_address").val(D),a(d+" input#b_address").val(""),
a(d+" input#radio_miles").attr("checked","checked"))});a(d+" div.d_close-wrapper").live("click",function(){b(d);a(this).parent().fadeOut();t.setMap(null);f.html("");f.hide();a(d+" button#print_sub").hide();c();return!1})}function l(e,k,d){K.getPanoramaByLocation(e.position,50,function(f,c){c===google.maps.StreetViewStatus.OK?a("a#trigger-"+k.bubbleHolderId).live("click",function(){var f={navigationControl:!0,enableCloseButton:!0,addressControl:!1,linksControl:!0,scrollwheel:!1,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},
position:e.position,pov:{heading:165,pitch:0,zoom:1}},c=new google.maps.StreetViewPanorama(document.getElementById("bubble-"+k.bubbleHolderId),f);c.setVisible(!0);google.maps.event.addListener(q,"closeclick",function(){b(d);a(d).fadeOut();null!=c&&(c.unbind("position"),c.setVisible(!1));c=null});google.maps.event.addListener(c,"closeclick",function(){null!=c&&(c.unbind("position"),c.setVisible(!1),a("div#bubble-"+k.bubbleHolderId).css("background","none"));c=null})}):(g.warn("There is not street view available for this marker location: "+
e.position+" status: "+c),a("a#trigger-"+k.bubbleHolderId).live("click",function(a){a.preventDefault()}),a("a#trigger-"+k.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important"),google.maps.event.addListener(q,"domready",function(){a("a#trigger-"+k.bubbleHolderId).removeAttr("href");a("a#trigger-"+k.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important")}))})}function I(){var e="div#direction-controls-placeholder-"+n,b=a("div#rendered-directions-placeholder-"+
n);a(e+" a#reverse-btn").live("click",function(){var d=a(e+" input#a_address").val(),b=a(e+" input#b_address").val();a(e+" input#a_address").val(b);a(e+" input#b_address").val(d);return!1});a(e+" a#d_options_show").live("click",function(){a(e+" a#d_options_hide").show();a(e+" a#d_options_show").hide();a(e+" div#d_options").show();return!1});a(e+" a#d_options_hide").live("click",function(){a(e+" a#d_options_hide").hide();a(e+" a#d_options_show").show();a(e+" div#d_options").hide();a(e+" input#avoid_hway").removeAttr("checked");
a(e+" input#avoid_tolls").removeAttr("checked");a(e+" input#radio_km").removeAttr("checked");a(e+" input#radio_miles").attr("checked","checked");return!1});a(e+" button#d_sub").live("click",function(){var d=a(e+" input#a_address").val(),f=a(e+" input#b_address").val(),c=!1;if(null==d||""==d)a(e+" input#a_address").addClass("d_error"),c=!0;if(null==f||""==f)a(e+" input#b_address").addClass("d_error"),c=!0;if(!c){a(e+" button#d_sub").attr("disabled","disabled").html("Please wait..");var h=google.maps.DirectionsTravelMode.DRIVING;
a(e+" a#dir_w_btn").hasClass("selected")&&(h=google.maps.DirectionsTravelMode.WALKING);var c=a(e+" input#avoid_hway").is(":checked"),l=a(e+" input#avoid_tolls").is(":checked"),j=a(e+" input#radio_miles").is(":checked"),h={origin:d,destination:f,travelMode:h,provideRouteAlternatives:!0};c&&(h.avoidHighways=!0);l&&(h.avoidTolls=!0);h.unitSystem=j?google.maps.DirectionsUnitSystem.IMPERIAL:google.maps.DirectionsUnitSystem.METRIC;L.route(h,function(c,h){h==google.maps.DirectionsStatus.OK?(b.html(""),b.show(),
t.setMap(i),t.setDirections(c),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"),a(e+" button#print_sub").fadeIn(),q.close()):(g.error('Could not route directions from "'+d+'" to "'+f+'", got result from Google: '+h),b.html("<span style='font-size: 12px; font-weight: bold; color: red'>Could not route directions from<br />'"+d+"' to<br />'"+f+"'<br />Got result from Google: ["+h+"]</span>"),a(e+" button#print_sub").hide(),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"))})}});
a(e+" button#print_sub").live("click",function(){var d=a(e+" input#a_address").val(),b=a(e+" input#b_address").val(),k="d";a(e+" a#dir_w_btn").hasClass("selected")&&(k="w");d="http://maps.google.com/?saddr="+d+"&daddr="+b+"&dirflg="+k+"&pw=2";a(e+" input#radio_miles").is(":checked")&&(d+="&doflg=ptm");window.open(d);return!1});a(e+" input#a_address").live("change focus",function(){a(e+" input#a_address").removeClass("d_error");return!1});a(e+" input#b_address").live("change focus",function(){a(e+
" input#b_address").removeClass("d_error");return!1});a(e+" .kd-button").live("click",function(){var d=this.id;"dir_d_btn"==d?a(e+" a#dir_d_btn").hasClass("selected")?g.warn("Driving travel mode is already selected"):(a(e+" a#dir_d_btn").addClass("selected"),a(e+" a#dir_w_btn").removeClass("selected")):"dir_w_btn"==d&&(a(e+" a#dir_w_btn").hasClass("selected")?g.warn("Walking travel mode is already selected"):(a(e+" a#dir_w_btn").addClass("selected"),a(e+" a#dir_d_btn").removeClass("selected")));return!1})}
function R(a,b){var d=Math.floor(111111*Math.random()),d=d+"-"+n,f="<div id='bubble-"+d+"' style='height: 130px !important; width: 300px !important;' class='bubble-content'>";if(b.geoMashup)var c=b.postTitle.substring(0,30),f=f+""+("<p style='text-align: left'><a style='font-size: 15px !important; font-weight: bold !important;' title='Original post: "+b.postTitle+"' href='"+b.postLink+"'>"+c+"..</a></p>"),f=f+("<p style='font-size: 12px !important; padding-left: 12px !important; padding-right: 6px !important; text-align: left; line-height: 130% !important'>"+
b.postExcerpt+"</p>");else f=f+"<h4>Address:</h4>"+("<p style='text-align: left'>"+a+"</p>");return{bubbleHolderId:d,bubbleContent:f+"<hr />"+("<p style='text-align: left'>Directions: <a id='toHere-"+d+"' class='dirToHereTrigger' href='javascript:void(0);'>To here</a> - <a id='fromHere-"+d+"' class='dirFromHereTrigger' href='javascript:void(0);'>From here</a> | <a id='trigger-"+d+"' class='streetViewTrigger' href='javascript:void(0);'>Street View</a></p>")+"</div>"}}function M(e,b){var d=1;a.each(e,
function(){g.info("Looping over JSON object:\n\tTitle: "+this.title+"\n\tAddy: "+this.addy+"\n\tLink: "+this.permalink+"\n\tExcerpt: "+this.excerpt);var a=this.addy.split(CGMPGlobal.sep);m.isNumeric(a[0])?N(a[0],d,a[1],this.title,this.permalink,this.excerpt,b):m.isAlphaNumeric(a[0])?y(a[0],d,a[1],this.title,this.permalink,this.excerpt,b):(y(a[0],d,a[1],this.title,this.permalink,this.excerpt,b),g.warn("Unknown type of geo destination in regexp: "+a[0]+", fallingback to store it as an address"));d++})}
function y(a,b,d,f,c,h,i){g.info("Storing address: "+a+" for marker-to-be for the map ID: "+n);u.push({address:a,animation:google.maps.Animation.DROP,zIndex:b,markerIcon:d,postTitle:f,postLink:c,postExcerpt:h,geoMashup:i})}function N(a,b,d,c,h,i,l){if(null==a||!a)return g.warn("Given GEO point containing Lat/Long is NULL"),!1;var j=a;if(!(j instanceof google.maps.LatLng)&&-1!=a.indexOf(",")){j=a.split(",",4);if(null==j||2!=j.length)return g.warn("Exploded lat/long array is NULL or does not have length of two"),
!1;if(null==j[0]||null==j[1])return g.warn("Lat or Long are NULL"),!1;j[0]=m.trim(j[0]);j[1]=m.trim(j[1]);if(""==j[0]||""==j[1])return g.warn("Lat or Long are empty string"),!1;a=parseFloat(j[0]);j=parseFloat(j[1]);j=new google.maps.LatLng(a,j)}y(j,b,d,c,h,i,l)}function v(){clearTimeout(z);if(0<u.length){var b=u.shift();g.info("Passing ["+b.address+"] to Geo service. Have left "+u.length+" items to process!");b.address instanceof google.maps.LatLng?S(b):O.geocode({address:b.address},function(a,c){T(a,
c,b)})}else{P();if(0<A.length){var c="";a.each(A,function(a,b){c+="\t"+(1+a)+". "+b+"\n"});alert(CGMPGlobal.errors.badAddresses.replace("[REPLACE]",c))}A=[]}}function P(){1<r.length?(a.each(r,function(a,b){B.contains(b.position)||B.extend(b.position)}),s=B,i.fitBounds(B),p=i.getZoom()):1==r.length&&(i.setCenter(r[0].position),p=i.getZoom())}function S(a){var b=a.address;1==a.zIndex&&(x=b);var d=b.lat(),d=parseFloat(d),d=d.toFixed(5),c=b.lng(),c=parseFloat(c),c=c.toFixed(5);a.address="Lat/Long: "+
d+", "+c;Q(b,a);v()}function T(a,b,d){b==google.maps.GeocoderStatus.OK?(Q(a[0].geometry.location,d),z=setTimeout(function(){v()},330)):b==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(P(),u.push(d),z=setTimeout(function(){v()},3E3)):b==google.maps.GeocoderStatus.ZERO_RESULTS&&(g.warn("Got ZERO results for ["+d.address+"]. Have left "+r.length+" items to process"),A.push(d.address),z=setTimeout(function(){v()},400))}function Q(b,c){var d=new google.maps.Marker({position:b,title:c.address.replace("<br />",
" :: "),content:c.address,zIndex:c.zIndex+1E3,map:i});if(d){if(c.markerIcon){var f=c.markerIcon;d.setIcon(CGMPGlobal.customMarkersUri+f);var h=null,h=["4-default.png","5-default.png","6-default.png","7-default.png"],h=-1!=a.inArray(f,["1-default.png","2-default.png"])?E("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",59,32,0,0,16,33):-1!=a.inArray(f,h)?E("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",59,32,0,0,21,34):-1!=f.indexOf("3-default")?E("http://code.google.com/apis/maps/documentation/javascript/examples/images/beachflag_shadow.png",
37,32,0,0,10,33):E(CGMPGlobal.customMarkersUri+"shadow.png",68,37,0,0,32,38);d.setShadow(h)}C(d,c);G||(I(),G=!0);r.push(d)}}function E(a,b,c,f,h,g,i){return new google.maps.MarkerImage(a,new google.maps.Size(b,c),new google.maps.Point(f,h),new google.maps.Point(g,i))}var r,u,A,H,z,G,i,w,J,s,x,p,n,O,B,q,K,t,L;return{init:function(a,b){i=a;n=i.getDiv().id;J=b;google.maps.event.addListener(i,"click",function(){c()});r=[];A=[];u=[];p=5;s=x=w=z=null;H=G=!1;O=new google.maps.Geocoder;B=new google.maps.LatLngBounds;
q=new google.maps.InfoWindow;K=new google.maps.StreetViewService;L=new google.maps.DirectionsService;rendererOptions={draggable:!0};t=new google.maps.DirectionsRenderer(rendererOptions);t.setPanel(document.getElementById("rendered-directions-placeholder-"+n))},buildAddressMarkers:function(b,c,d){H=!0;w=m.trim(b);w=m.searchReplace(w,"'","");if("true"==c)b=a.parseJSON(w),"true"==d?M(b,!0):"false"==d&&M(b,!1),v();else if("false"==c){d=w.split("|");g.info("Exploded CSV into locations: "+d);for(b=0;b<
d.length;b++){var f=d[b];null!=f&&""!=f&&(f=m.trim(f),""==f?g.warn("Given extra marker address is empty"):(c=b+1,f=f.split(CGMPGlobal.sep),m.isNumeric(f[0])?N(f[0],c,f[1],"","","",!1):m.isAlphaNumeric(f[0])?y(f[0],c,f[1],"","","",!1):(y(f[0],c,f[1],"","","",!1),g.warn("Unknown type of geo destination in regexp: "+f[0]+", fallingback to store it as an address"))))}v()}},isBuildAddressMarkersCalled:function(){return H}}},m=function(){return{isNumeric:function(a){return/^([0-9?(\-.,\s{1,})]+)$/.test(a)},
isAlphaNumeric:function(a){return/^([a-zA-Z0-9?(/\-.,\s{1,})]+)$/.test(a)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},searchReplace:function(a,b,c){return a.replace(RegExp(b,"g"),c)}}}(),g=function(){var c=function(b){a.browser.msie||(a.browser.mozilla&&3<=parseInt(a.browser.version)?console.log(b):console.log("Logger could not print because browser is Mozilla ["+a.browser.mozilla+"] and its version is ["+parseInt(a.browser.version)+"]"))};return{info:function(a){c("Info :: "+a)},raw:function(a){c(a)},
warn:function(a){c("Warning :: "+a)},error:function(a){c("Error :: "+a)},fatal:function(a){c("Fatal :: "+a)}}}();"undefined"!=typeof CGMPGlobal&&CGMPGlobal.maps?(g.info("The CGMPGlobal object has ["+CGMPGlobal.maps.length+"] map JSONs inside"),a.each(CGMPGlobal.maps,function(h,b){if("undefined"==typeof google||!google)return alert(CGMPGlobal.errors.msgNoGoogle),g.fatal("We do not have reference to Google API. Aborting map generation .."),!1;if("undefined"!=typeof GMap2&&GMap2)return alert(CGMPGlobal.errors.msgApiV2),
g.fatal("It looks like the webpage has reference to GMap2 object from Google API v2. Aborting map generation .."),!1;if(0<a("div#"+b.id).length){var m=new google.maps.Map(document.getElementById(b.id));c.initMap(m,b.bubbleautopan,parseInt(b.zoom),b.maptype);o.init(m);var F=new I;F.init(m,b.bubbleautopan);c.mapControl(b.maptypecontrol,c.ControlType.MAPTYPE);c.mapControl(b.pancontrol,c.ControlType.PAN);c.mapControl(b.zoomcontrol,c.ControlType.ZOOM);c.mapControl(b.scalecontrol,c.ControlType.SCALE);c.mapControl(b.scrollwheelcontrol,
c.ControlType.SCROLLWHEEL);c.mapControl(b.streetviewcontrol,c.ControlType.STREETVIEW);"true"==b.showpanoramio&&o.buildPanoramioLayer(b.panoramiouid);"true"==b.showbike&&o.buildBikeLayer();"true"==b.showtraffic&&o.buildTrafficLayer();null!=b.kml&&""!=b.kml?o.buildKmlLayer(b.kml):(null!=b.markerlist&&""!=b.markerlist&&F.buildAddressMarkers(b.markerlist,b.addmarkermashup,b.geomashupbubble),F.isBuildAddressMarkersCalled()||alert(CGMPGlobal.errors.msgMissingMarkers))}else g.fatal("It looks like the map DIV placeholder ID ["+
b.id+"] does not exist in the page!")})):g.fatal("The CGMPGlobal object is undefined. Aborting map generation .. d[-_-]b")})(jQueryCgmp);
