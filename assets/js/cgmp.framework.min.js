(function(){("undefined"==typeof jQuery||null==jQuery)&&alert("You dont have jQuery library loaded, aborting map generation :(")})();var jQueryCgmp=jQuery.noConflict();
(function(a){var h,n,F,G,u=function(){f.fatal("Using parseJson stub..")};1.4<=parseFloat(a.fn.jquery)?u=a.parseJSON:window.JSON&&window.JSON.parse&&(u=window.JSON.parse);h=void 0;n=void 0;F=void 0;G=void 0;var i=function(){var a={};return{initMap:function(c,b,f,d){a=c;var c=[],i;for(i in google.maps.MapTypeId)c.push(google.maps.MapTypeId[i]);"ROADMAP"==d?d=google.maps.MapTypeId.ROADMAP:"SATELLITE"==d?d=google.maps.MapTypeId.SATELLITE:"HYBRID"==d?d=google.maps.MapTypeId.HYBRID:"TERRAIN"==d?d=google.maps.MapTypeId.TERRAIN:
"OSM"==d&&(d="OSM",c.push(d),a.mapTypes.set(d,new google.maps.ImageMapType({getTileUrl:function(a,b){return"http://tile.openstreetmap.org/"+b+"/"+a.x+"/"+a.y+".png"},tileSize:new google.maps.Size(256,256),name:"OpenStreet",maxZoom:20})));a.setOptions({zoom:f,mapTypeId:d,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:c}})},mapControl:function(c,b){switch(b){case i.ControlType.SCROLLWHEEL:a.setOptions({scrollwheel:"false"==c?!1:!0});break;case i.ControlType.MAPTYPE:a.setOptions({mapTypeControl:"false"==
c?!1:!0});break;case i.ControlType.PAN:a.setOptions({panControl:"false"==c?!1:!0});break;case i.ControlType.ZOOM:a.setOptions({zoomControl:"false"==c?!1:!0});break;case i.ControlType.SCALE:a.setOptions({scaleControl:"false"==c?!1:!0});break;case i.ControlType.STREETVIEW:a.setOptions({streetViewControl:"false"==c?!1:!0});break;default:f.warn("Unknown map control type: "+b)}},ControlType:{PAN:0,ZOOM:1,SCALE:2,STREETVIEW:3,MAPTYPE:4,SCROLLWHEEL:5}}}(),q=function(){var a={};return{init:function(c){a=
c},buildKmlLayer:function(c){if(0>c.toLowerCase().indexOf("http"))return f.error("KML URL must start with HTTP(S). Aborting.."),!1;var b=new google.maps.KmlLayer(c);google.maps.event.addListener(b,"status_changed",function(){var a=b.getStatus();if(a!=google.maps.KmlLayerStatus.OK){var c="";switch(a){case google.maps.KmlLayerStatus.DOCUMENT_NOT_FOUND:c=h.kmlNotFound;break;case google.maps.KmlLayerStatus.DOCUMENT_TOO_LARGE:c=h.kmlTooLarge;break;case google.maps.KmlLayerStatus.FETCH_ERROR:c=h.kmlFetchError;
break;case google.maps.KmlLayerStatus.INVALID_DOCUMENT:c=h.kmlDocInvalid;break;case google.maps.KmlLayerStatus.INVALID_REQUEST:c=h.kmlRequestInvalid;break;case google.maps.KmlLayerStatus.LIMITS_EXCEEDED:c=h.kmlLimits;break;case google.maps.KmlLayerStatus.TIMED_OUT:c=h.kmlTimedOut;break;case google.maps.KmlLayerStatus.UNKNOWN:c=h.kmlUnknown}if(""!=c){var k=h.kml.replace("[MSG]",c),k=k.replace("[STATUS]",a);A.alertError(k);f.error("Google returned KML error: "+c+" ("+a+")");f.error("KML file: "+b.getUrl())}}});
b.setMap(a)},buildTrafficLayer:function(){(new google.maps.TrafficLayer).setMap(a)},buildBikeLayer:function(){(new google.maps.BicyclingLayer).setMap(a)},buildPanoramioLayer:function(c){if("undefined"==typeof google.maps.panoramio||!google.maps.panoramio||null==google.maps.panoramio)return f.error("We cannot access Panoramio library. Aborting.."),!1;var b=new google.maps.panoramio.PanoramioLayer;b?(null!=c&&""!=c&&b.setUserId(c),b.setMap(a)):f.error("Could not instantiate Panoramio object. Aborting..")}}}(),
L=function(){function k(){null!=r?l.getCenter()!=r.getCenter()&&(f.info("Panning map back to its original bounds center: "+r.getCenter()),l.fitBounds(r),l.setCenter(r.getCenter())):null!=B&&(f.info("Panning map back to its original center: "+B+" and updated zoom: "+H),l.setCenter(B),l.setZoom(H))}function c(e){a(e+" input#a_address").val("");a(e+" input#b_address").val("");a(e+" input#a_address").removeClass("d_error");a(e+" input#b_address").removeClass("d_error")}function b(e,j){var g=U(e.content,
j),m="div#direction-controls-placeholder-"+p,b=a("div#rendered-directions-placeholder-"+p);google.maps.event.addListener(e,"click",function(){c(m);a(m).fadeOut();v.setMap(null);b.html("");b.hide();a(m+" button#print_sub").hide();s.setContent(g.bubbleContent);s.setOptions({disableAutoPan:"true"==N?!1:!0});s.open(l,this)});d(e,g,m);i(e,g,m,b)}function i(e,j,g,m){var b="div#bubble-"+j.bubbleHolderId,f=e.content,f=f.replace("Lat/Long: ","");a(b+" a.dirToHereTrigger").live("click",function(){this.id==
"toHere-"+j.bubbleHolderId&&(a(g).fadeIn(),a(g+" input#a_address").val(""),a(g+" input#b_address").val(f),a(g+" input#radio_miles").attr("checked","checked"))});a(b+" a.dirFromHereTrigger").live("click",function(){this.id=="fromHere-"+j.bubbleHolderId&&(a(g).fadeIn(),a(g+" input#a_address").val(f),a(g+" input#b_address").val(""),a(g+" input#radio_miles").attr("checked","checked"))});a(g+" div.d_close-wrapper").live("click",function(){c(g);a(this).parent().fadeOut();v.setMap(null);m.html("");m.hide();
a(g+" button#print_sub").hide();k();return!1})}function d(e,j,g){O.getPanoramaByLocation(e.position,50,function(m,b){b===google.maps.StreetViewStatus.OK?a("a#trigger-"+j.bubbleHolderId).live("click",function(){var m={navigationControl:!0,enableCloseButton:!0,addressControl:!1,linksControl:!0,scrollwheel:!1,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},position:e.position,pov:{heading:165,pitch:0,zoom:1}},b=new google.maps.StreetViewPanorama(document.getElementById("bubble-"+
j.bubbleHolderId),m);b.setVisible(!0);google.maps.event.addListener(s,"closeclick",function(){c(g);a(g).fadeOut();null!=b&&(b.unbind("position"),b.setVisible(!1));b=null});google.maps.event.addListener(b,"closeclick",function(){null!=b&&(b.unbind("position"),b.setVisible(!1),a("div#bubble-"+j.bubbleHolderId).css("background","none"));b=null})}):(f.warn("There is not street view available for this marker location: "+e.position+" status: "+b),a("a#trigger-"+j.bubbleHolderId).live("click",function(a){a.preventDefault()}),
a("a#trigger-"+j.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important"),google.maps.event.addListener(s,"domready",function(){a("a#trigger-"+j.bubbleHolderId).removeAttr("href");a("a#trigger-"+j.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important")}))})}function q(){var e="div#direction-controls-placeholder-"+p,j=a("div#rendered-directions-placeholder-"+p);a(e+" a#reverse-btn").live("click",function(){var g=a(e+" input#a_address").val(),
j=a(e+" input#b_address").val();a(e+" input#a_address").val(j);a(e+" input#b_address").val(g);return!1});a(e+" a#d_options_show").live("click",function(){a(e+" a#d_options_hide").show();a(e+" a#d_options_show").hide();a(e+" div#d_options").show();return!1});a(e+" a#d_options_hide").live("click",function(){a(e+" a#d_options_hide").hide();a(e+" a#d_options_show").show();a(e+" div#d_options").hide();a(e+" input#avoid_hway").removeAttr("checked");a(e+" input#avoid_tolls").removeAttr("checked");a(e+" input#radio_km").removeAttr("checked");
a(e+" input#radio_miles").attr("checked","checked");return!1});a(e+" button#d_sub").live("click",function(){var g=a(e+" input#a_address").val(),b=a(e+" input#b_address").val(),c=!1;if(null==g||""==g)a(e+" input#a_address").addClass("d_error"),c=!0;if(null==b||""==b)a(e+" input#b_address").addClass("d_error"),c=!0;if(!c){a(e+" button#d_sub").attr("disabled","disabled").html("Please wait..");var d=google.maps.DirectionsTravelMode.DRIVING;a(e+" a#dir_w_btn").hasClass("selected")&&(d=google.maps.DirectionsTravelMode.WALKING);
var c=a(e+" input#avoid_hway").is(":checked"),k=a(e+" input#avoid_tolls").is(":checked"),i=a(e+" input#radio_miles").is(":checked"),d={origin:g,destination:b,travelMode:d,provideRouteAlternatives:!0};c&&(d.avoidHighways=!0);k&&(d.avoidTolls=!0);d.unitSystem=i?google.maps.DirectionsUnitSystem.IMPERIAL:google.maps.DirectionsUnitSystem.METRIC;P.route(d,function(c,d){d==google.maps.DirectionsStatus.OK?(j.html(""),j.show(),v.setMap(l),v.setDirections(c),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"),
a(e+" button#print_sub").fadeIn(),s.close()):(f.error('Could not route directions from "'+g+'" to "'+b+'", got result from Google: '+d),j.html("<span style='font-size: 12px; font-weight: bold; color: red'>Could not route directions from<br />'"+g+"' to<br />'"+b+"'<br />Got result from Google: ["+d+"]</span>"),a(e+" button#print_sub").hide(),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"))})}});a(e+" button#print_sub").live("click",function(){var b=a(e+" input#a_address").val(),
j=a(e+" input#b_address").val(),c="d";a(e+" a#dir_w_btn").hasClass("selected")&&(c="w");b="http://maps.google.com/?saddr="+b+"&daddr="+j+"&dirflg="+c+"&pw=2";a(e+" input#radio_miles").is(":checked")&&(b+="&doflg=ptm");window.open(b);return!1});a(e+" input#a_address").live("change focus",function(){a(e+" input#a_address").removeClass("d_error");return!1});a(e+" input#b_address").live("change focus",function(){a(e+" input#b_address").removeClass("d_error");return!1});a(e+" .kd-button").live("click",
function(){var b=this.id;"dir_d_btn"==b?a(e+" a#dir_d_btn").hasClass("selected")?f.warn("Driving travel mode is already selected"):(a(e+" a#dir_d_btn").addClass("selected"),a(e+" a#dir_w_btn").removeClass("selected")):"dir_w_btn"==b&&(a(e+" a#dir_w_btn").hasClass("selected")?f.warn("Walking travel mode is already selected"):(a(e+" a#dir_w_btn").addClass("selected"),a(e+" a#dir_d_btn").removeClass("selected")));return!1})}function U(a,b){var g=Math.floor(111111*Math.random()),g=g+"-"+p,c="<div id='bubble-"+
g+"' style='height: 130px !important; width: 300px !important;' class='bubble-content'>";if(b.geoMashup)var d=b.postTitle.substring(0,30),c=c+""+("<p style='text-align: left'><a style='font-size: 15px !important; font-weight: bold !important;' title='Original post: "+b.postTitle+"' href='"+b.postLink+"'>"+d+"..</a></p>"),c=c+("<p style='font-size: 12px !important; padding-left: 12px !important; padding-right: 6px !important; text-align: left; line-height: 130% !important'>"+b.postExcerpt+"</p>");
else c+="<h4>"+n.address+":</h4>",c+="<p style='text-align: left'>"+a+"</p>",""!=b.customBubbleText&&(c+="<p style='text-align: left; margin-top: 5px !important;'>"+b.customBubbleText+"</p>");c=c+"<hr />"+("<p style='text-align: left'>"+n.directions+": <a id='toHere-"+g+"' class='dirToHereTrigger' href='javascript:void(0);'>"+n.toHere+"</a> - <a id='fromHere-"+g+"' class='dirFromHereTrigger' href='javascript:void(0);'>"+n.fromHere+"</a> | <a id='trigger-"+g+"' class='streetViewTrigger' href='javascript:void(0);'>"+
n.streetView+"</a></p>");return{bubbleHolderId:g,bubbleContent:c+"</div>"}}function M(b,c){var g=1;a.each(b,function(){null==this.excerpt&&(this.excerpt="");f.info("Looping over JSON object:\n\tTitle: "+this.title+"\n\tAddy: "+this.addy+"\n\tLink: "+this.permalink+"\n\tExcerpt: "+this.excerpt);var a=this.addy.split(F);o.isNumeric(a[0])?Q(g,a,this.title,this.permalink,this.excerpt,c):o.isAlphaNumeric(a[0])?C(g,a,this.title,this.permalink,this.excerpt,c):(C(g,a,this.title,this.permalink,this.excerpt,
c),f.warn("Unknown type of geo destination in regexp: "+a[0]+", fallingback to store it as an address"));g++})}function C(a,b,c,m,d,k){null!=b[2]?-1!=b[2].indexOf("No description provided")&&(b[2]=""):b[2]="";f.info("Storing address: "+b[0]+" for marker-to-be for the map ID: "+p);w.push({address:b[0],animation:google.maps.Animation.DROP,zIndex:a,markerIcon:b[1],customBubbleText:b[2],postTitle:c,postLink:m,postExcerpt:d,geoMashup:k})}function Q(a,b,c,m,d,k){if(null==b[0]||!b[0])return f.warn("Given GEO point containing Lat/Long is NULL"),
!1;var i=b[0];if(!(i instanceof google.maps.LatLng)&&-1!=b[0].indexOf(",")){var h=b[0].split(",",4);if(null==h||2!=h.length)return f.warn("Exploded lat/long array is NULL or does not have length of two"),!1;if(null==h[0]||null==h[1])return f.warn("Lat or Long are NULL"),!1;h[0]=o.trim(h[0]);h[1]=o.trim(h[1]);if(""==h[0]||""==h[1])return f.warn("Lat or Long are empty string"),!1;i=parseFloat(h[0]);h=parseFloat(h[1]);i=new google.maps.LatLng(i,h)}b[0]=i;C(a,b,c,m,d,k)}function x(){clearTimeout(D);if(0<
w.length){var b=w.shift();f.info("Passing ["+b.address+"] to Geo service. Have left "+w.length+" items to process!");b.address instanceof google.maps.LatLng?L(b):R.geocode({address:b.address},function(a,c){V(a,c,b)})}else{S();if(0<E.length){var c="";a.each(E,function(a,b){c+="&nbsp;&nbsp;&nbsp;<b>"+(1+a)+". "+b+"</b><br />"});A.alertError(h.badAddresses.replace("[REPLACE]",c))}E=[]}}function S(){1<t.length?(a.each(t,function(a,b){y.contains(b.position)||y.extend(b.position)}),r=y,null!=y&&l.fitBounds(y)):
1==t.length&&(l.setCenter(t[0].position),H=l.getZoom(),B=l.getCenter())}function L(a){var b=a.address,c=b.lat(),c=parseFloat(c),c=c.toFixed(5),d=b.lng(),d=parseFloat(d),d=d.toFixed(5);a.address="Lat/Long: "+c+", "+d;T(b,a);x()}function V(a,b,c){b==google.maps.GeocoderStatus.OK?(T(a[0].geometry.location,c),D=setTimeout(function(){x()},330)):b==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(S(),w.push(c),D=setTimeout(function(){x()},3E3)):b==google.maps.GeocoderStatus.ZERO_RESULTS&&(f.warn("Got ZERO results for ["+
c.address+"]. Have left "+t.length+" items to process"),E.push(c.address),D=setTimeout(function(){x()},400))}function T(c,d){var g=new google.maps.Marker({position:c,title:d.address.replace("<br />"," :: "),content:d.address,zIndex:d.zIndex+1E3,map:l});if(g){if(d.markerIcon){var f=d.markerIcon;g.setIcon(G+f);var k=null,k=["4-default.png","5-default.png","6-default.png","7-default.png"],k=-1!=a.inArray(f,["1-default.png","2-default.png"])?I("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",
59,32,0,0,16,33):-1!=a.inArray(f,k)?I("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",59,32,0,0,21,34):-1!=f.indexOf("3-default")?I("http://code.google.com/apis/maps/documentation/javascript/examples/images/beachflag_shadow.png",37,32,0,0,10,33):I(G+"shadow.png",68,37,0,0,32,38);g.setShadow(k)}b(g,d);J||(q(),J=!0);t.push(g)}}function I(a,b,c,d,f,k,h){return new google.maps.MarkerImage(a,new google.maps.Size(b,c),new google.maps.Point(d,f),new google.maps.Point(k,h))}var t,w,E,K,D,J,
l,z,N,r,B,H,p,R,y,s,O,v,P;return{init:function(a,b){l=a;p=l.getDiv().id;N=b;google.maps.event.addListener(l,"click",function(){k()});t=[];E=[];w=[];H=5;r=B=z=D=null;K=J=!1;R=new google.maps.Geocoder;y=new google.maps.LatLngBounds;s=new google.maps.InfoWindow;O=new google.maps.StreetViewService;P=new google.maps.DirectionsService;rendererOptions={draggable:!0};v=new google.maps.DirectionsRenderer(rendererOptions);v.setPanel(document.getElementById("rendered-directions-placeholder-"+p))},buildAddressMarkers:function(a,
b,c){K=!0;z=o.trim(a);z=o.searchReplace(z,"'","");if("true"==b)a=u(z),"true"==c?M(a,!0):"false"==c&&M(a,!1),x();else if("false"==b){c=z.split("|");f.info("Exploded CSV into locations: "+c);for(a=0;a<c.length;a++){var d=c[a];null!=d&&""!=d&&(d=o.trim(d),""==d?f.warn("Given extra marker address is empty"):(b=a+1,d=d.split(F),o.isNumeric(d[0])?Q(b,d,"","","",!1):o.isAlphaNumeric(d[0])?C(b,d,"","","",!1):(C(b,d,"","","",!1),f.warn("Unknown type of geo destination in regexp: "+d[0]+", fallingback to store it as an address"))))}x()}},
isBuildAddressMarkersCalled:function(){return K}}},o=function(){return{isNumeric:function(a){return/^([0-9?(\-.,\s{1,})]+)$/.test(a)},isAlphaNumeric:function(a){return/^([a-zA-Z0-9?(/\-.,\s{1,})]+)$/.test(a)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},searchReplace:function(a,c,b){return a.replace(RegExp(c,"g"),b)}}}(),f=function(){var f=function(c){a.browser.msie||(a.browser.mozilla&&3<=parseInt(a.browser.version)?console.log(c):a.browser.webkit?console.log(c):console.log("Logger could not print because browser is not webkit nor mozilla, and its version is ["+
parseInt(a.browser.version)+"]"))};return{info:function(a){f("Info :: "+a)},raw:function(a){f(a)},warn:function(a){f("Warning :: "+a)},error:function(a){f("Error :: "+a)},fatal:function(a){f("Fatal :: "+a)}}}(),A=function(){return{alertError:function(f){var c=a('<div id="cgmp-popup-mask"/>'),b=Math.random().toString(36).substring(3),h=a('<div id="'+b+'" class="cgmp-popup-shortcode-dialog cgmp-popup-window" />');h.html("<p style='padding: 10px 10px 0 10px'>"+f+"</p><div align='center'><input type='button' class='close-dialog' value='Close' /></div>");
a("body").append(c);a("body").append(h);f=a(document).height();c=a(window).width();a("#cgmp-popup-mask").css({width:c,height:f,opacity:0.3});1==a("#cgmp-popup-mask").length&&a("#cgmp-popup-mask").show();f=a(window).height();c=a(window).width();a("div#"+b).css("top",f/2-a("div#"+b).height()/2);a("div#"+b).css("left",c/2-a("div#"+b).width()/2);a("div#"+b).fadeIn(500);a(".cgmp-popup-window .close-dialog").click(function(b){b.preventDefault();(b=a(this).closest("div.cgmp-popup-shortcode-dialog"))&&a(b).remove();
0==a("div.cgmp-popup-shortcode-dialog").length&&a("#cgmp-popup-mask").remove()});a("#cgmp-popup-mask").click(function(){a(this).remove();a(".cgmp-popup-window").remove()});a(window).resize(function(){var b=a(".window"),c=a(document).height(),f=a(window).width();a("#cgmp-popup-mask").css({width:f,height:c});c=a(window).height();f=a(window).width();b.css("top",c/2-b.height()/2);b.css("left",f/2-b.width()/2)})}}}();0==a("object#global-data-placeholder").length?f.fatal("The global HTML <object> element is undefined. Aborting map generation .. d[-_-]b"):
(F=a("object#global-data-placeholder").find("param#sep").val(),G=a("object#global-data-placeholder").find("param#customMarkersUri").val(),h=a("object#global-data-placeholder").find("param#errors").val(),h=u(h),n=a("object#global-data-placeholder").find("param#translations").val(),n=u(n),a("object.map-data-placeholder").each(function(k,c){if("undefined"==typeof google||!google)return A.alertError(h.msgNoGoogle),f.fatal("We do not have reference to Google API. Aborting map generation .."),!1;if("undefined"!=
typeof GMap2&&GMap2)return A.alertError(h.msgApiV2),f.fatal("It looks like the webpage has reference to GMap2 object from Google API v2. Aborting map generation .."),!1;var b=a(c).find("param").val(),b=o.searchReplace(b,"'",""),b=u(b);if("undefined"==typeof b||!b)return f.fatal("We did not parse JSON from OBJECT param. Aborting map generation .."),!1;if(0<a("div#"+b.id).length){var n=new google.maps.Map(document.getElementById(b.id));i.initMap(n,b.bubbleautopan,parseInt(b.zoom),b.maptype);q.init(n);
var d=new L;d.init(n,b.bubbleautopan);i.mapControl(b.maptypecontrol,i.ControlType.MAPTYPE);i.mapControl(b.pancontrol,i.ControlType.PAN);i.mapControl(b.zoomcontrol,i.ControlType.ZOOM);i.mapControl(b.scalecontrol,i.ControlType.SCALE);i.mapControl(b.scrollwheelcontrol,i.ControlType.SCROLLWHEEL);i.mapControl(b.streetviewcontrol,i.ControlType.STREETVIEW);"true"==b.showpanoramio&&q.buildPanoramioLayer(b.panoramiouid);"true"==b.showbike&&q.buildBikeLayer();"true"==b.showtraffic&&q.buildTrafficLayer();null!=
b.kml&&""!=b.kml?q.buildKmlLayer(b.kml):(null!=b.markerlist&&""!=b.markerlist&&d.buildAddressMarkers(b.markerlist,b.addmarkermashup,b.addmarkermashupbubble),d.isBuildAddressMarkersCalled()||A.alertError(h.msgMissingMarkers))}else f.fatal("It looks like the map DIV placeholder ID ["+b.id+"] does not exist in the page!")}))})(jQueryCgmp);
